<html>
<head>
	<link type="text/css" href="css/foundation.css" rel="stylesheet" />
	<link type="text/css" href="css/screen.css" rel="stylesheet" />
	<link type="text/css" href="css/jquery.selectBox.css" rel="stylesheet" />
	<title>MASLO - Preview</title>
</head>
<body>
	<header>
	<h3><a href="index.html">My Content Packs</a> >
		<a class="back" href="">hello</a> > Preview</h3>
	<div class="extra"><a href="#">Help</a><img src="icons/maslo_icon_logo.png" /></div>
	</header>

	<div id="focus">
		<div class="nav">
			<h2>Table of Contents / Page <span class="pg">1</span></h2>
			<select size="10" class="toc">
			</select>
		</div>

		<div class="phone">
			<img class="background" src="icons/phone.png" alt="Phone" />
			<div class="viewport">
				<div class="canvas">
					<ul class="data"></ul>
				</div>
			</div>
		</div>
	</div>

	<div class="action">
		<button class="nice small radius blue button" type="button">Publish</button>
		<button class="nice small radius blue button" id="back" type="button">Back</button>
		<div class="clear"></div>
	</div>


<script type="text/javascript" src="AIRAliases.js"></script>
<script type="text/javascript" src="js/jquery-1.6.1.min.js"></script>
<script type="text/javascript" src="js/jquery.selectBox.min.js"></script>
<script type="text/javascript" src="js/jquery.scroll.js"></script>
<script type="text/javascript" src="js/mpthrize.js"></script>
<script type="text/javascript" src="js/param.js"></script>
<script type="text/javascript" src="js/files.js"></script>
<script type="text/javascript" src="js/types.js"></script>
<script type="text/javascript" src="js/manifest.js"></script>
<script type="text/javascript">

// this will be called on page turn, and will be used to stop
// audio that might have been playing in a page.
var gSwitchHandler = function() {};

// -------------------------- SET UP PAGE -------------------------
$(document).ready(function() {
	var gPageParams = queryParameters(document.location.search);
	$('a.back').attr('href', 'proj.html?name=' + gPageParams.name);
	$('a.back').text(gPageParams.name.toString());
	$('#back').click(function() {
		window.location = 'proj.html?name=' + gPageParams.name;
	});

	var gManifest = manifest(gPageParams.name);
	// the visible TOC ui
	var s = $('select');
	// the hidden source of actual data
	var d = $('ul.data');
	for(var m in gManifest) {
		m = gManifest[m];
		s.append("<option>" + m.title + "</option>");
		var path = air.File.applicationStorageDirectory.resolvePath(m.path).nativePath;
		var li = $('<li style="display:none"></li>');
		if(m.type == 'text') {
			li.append('<span>' + loadTextfile(path) + '</span>');
		} else if(m.type == 'image') {
			li.append(['<img src=', 'file://' + path, '/>'].join('"'));
		} else if(m.type == 'audio') {
			// save the STOP AUDIO function
			gSwitchHandler = mpthrize(li, 'file://' + path);
		}
		if(m.description) {
			li.append('<p>' + m.description + '</p>');
		}
		d.append(li);
	}


// ----------------------- LOAD FIRST PAGE INTO PHONE ----------------------
	$('div.canvas li:eq(0)').toggle();
	$("select option:first").attr('selected','selected');
	

// -------------------------- SET UP CLICK HANDLER -------------------------
	$("select").selectBox().change( function() {
		gSwitchHandler();
		$('div.canvas li').hide();
		$('div.canvas li:eq(' + this.selectedIndex + ')').show();
	});
});
</script>
</body>
</html>
