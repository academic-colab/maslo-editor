<html>
<head>
	<link type="text/css" href="css/maslo-theme/jquery-ui-1.8.16.custom.css" rel="stylesheet" /> 
	<link type="text/css" href="css/foundation.css" rel="stylesheet" />
	<link type="text/css" href="css/screen.css" rel="stylesheet" />
	<link type="text/css" href="css/jquery.cleditor.css" rel="stylesheet" />
	<title>MASLO - Edit Quiz</title>
</head>
<body>
	<header>
	<h3><a href="index.html">My Content Packs</a> >
	<a class="back" href="#"></a> >
	<span class="current"></span></h3>
<div class="extra"><a href="#">Help</a>
<img src="icons/maslo_icon_logo.png" />
</div>
	</header>
<table>
<thead>
	<tr>
		<th>Type</th>
		<th class="big">Title</th>
		<th>Remove</th>
	</tr>
</thead>
<tbody class="proj">
</tbody>
</table>
<div class="action">
	<a class="alt nice small radius blue button" href="">+ Add Question</a>
	<button class="nice small radius blue button" id="back">Back</button>
	<div class="clear"></div>
</div>

<form id="dialog-question" style="display: none" title="Edit Question">
	<fieldset>
		<label for="question">Question</label>
		<textarea rows="2" cols="50" name="question"></textarea>
	</fieldset>
	<input type="button" value="+ Add another answer"
		onclick="addAnswer($('#dialog-question fieldset'))"/>
</form>
<div id="dialog-confirm" style="display: none" title="Delete Content">
	<p>This question will be permanently deleted and cannot be
	recovered. Are you sure?</p>
</div>

<script type="text/javascript" src="AIRAliases.js"></script>
<script type="text/javascript" src="js/jquery-1.6.1.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.14.custom.min.js"></script>
<script type="text/javascript" src="js/jquery.selectBox.min.js"></script>
<script type="text/javascript" src="js/urldecode.js"></script>
<script type="text/javascript" src="js/mpthrize.js"></script>
<script type="text/javascript" src="js/param.js"></script>
<script type="text/javascript" src="js/files.js"></script>
<script type="text/javascript" src="js/load.js"></script>
<script type="text/javascript" src="js/types.js"></script>
<script type="text/javascript" src="js/manifest.js"></script>
<script type="text/javascript">

// -------------------------- SET UP PAGE -------------------------
$(document).ready(function() {
	var gPageParams = queryParameters(document.location.search);
	// the parameter "name" is formatted as "project/quiz"
	var names = gPageParams.name.toString().split(air.File.separator);
	var gProj = urldecode(names[0]);
	var gName = urldecode(names[1]);
	$('a.back').attr('href', 'proj.html?name=' + gProj);
	$('a.back').text(gProj.toString());
	$('span.current').text(gName.toString());
	$('#back').click(function() {
		window.location = 'proj.html?name=' + gProj;
	});

	var	gManifest = manifest(gPageParams.name);
	for(var m in gManifest) {
		m = gManifest[m];
		appendItemToQuiz(m, $('tbody.proj'));
	}
	linkManifestOrderToTable(gManifest, $('tbody.proj'), gPageParams.name);

	$('.action a.alt').click(function() {
		var m = {"question": "", "type": "question"};
		var newlink = appendItemToQuiz(m, $('tbody.proj'));
		gManifest.push(m);
		saveManifest(gManifest, gPageParams.name);

		$('#dialog-question fieldset .answer').empty();
		addAnswer($('#dialog-question fieldset'));
		addAnswer($('#dialog-question fieldset'));
		addAnswer($('#dialog-question fieldset'));
		$('#dialog-question').dialog({
			autoOpen: true,
			modal: true,
			width: 540,
			position: 'top',
			buttons: {
				"Save": function() {
					
				}
			},
			open: function(event, ui) {
				$('div.ui-button-text button').attr('disabled', 'disabled');
			}
		});
		return false;
	});

});

function appendItemToQuiz(m, list) {
	var tr = $('<tr />');

	if(m.type == 'unknown' || !iconForType(m.type)) {
		return;
	}
	tr.append($('<td class="icon"><img src="' + iconForType(m.type) + '"/></td>'));
	tr.append($('<td><a rel="' + m.type + '" href="#">' +
				(m.question ? m.question : 'unwritten question') + '</a></td>'));
	tr.append($('<td class="icon"><img class="remove" src="icons/remove.png" alt="Remove Item" /></td>'));
	list.append(tr);
	//activateItemLinks(tr.find('a'));
	activateRemoveLinks(tr.find('img.remove'));
	return tr;
}

function addAnswer(q) {
	var a = $('<div class="answer" />')

	var killer = $('<img class="remove" src="icons/remove.png" alt="Remove Item" />');
	killer.click(function() {
		a.remove();
	});
	a.append(killer);

	a.append($('<label for="answer">Answer</label>'))
	a.append($('<input type"text" name="answer" />'));

	a.append($('<input type="checkbox" name="correct" />'));
	a.append($('<label for="correct">Correct</label>'));

	a.append($('<input type="button" value="+ Feedback" />'));
	q.append(a);
}

function activateRemoveLinks(link) {
	link.click(function(e) {
		var elt = $(this).parent().parent();
		$( "#dialog-confirm" ).dialog({
			height:240,
			modal: true,
			buttons: {
				"Delete Content": function() {
					gManifest.splice(elt.index(), 1);
					saveManifest(gManifest, gPageParams.name);
					elt.remove();
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					$( this ).dialog( "close" );
				}
			}
		});
	});
}

</script>
</body>
</html>

