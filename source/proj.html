<html>
<head>
  <link type="text/css" href="css/ui-lightness/jquery-ui-1.8.14.custom.css" rel="stylesheet" /> 
  <link type="text/css" href="css/screen.css" rel="stylesheet" />
  <link type="text/css" href="css/jquery.cleditor.css" rel="stylesheet" />
  <title>MASLO - Edit Project</title>
</head>
<body>
  <h1><a href="index.html">My Content Packs</a> > <span id="proj"></span></h1>
  <table>
    <thead>
      <tr><th>Type</th><th>Title</th><th>Status</th><th>Remove</th></tr>
    </thead>
    <tbody class="proj">
    </tbody>
  </table>

  <div class="action">
    <a class="alt" href="">+ Add Content</a>
    <div class="alt">
      <input type="text" length="10" />
      <button type="button">OK</button>
      <button type="button" class="cancel">Cancel</button>
    </div>
    <button type="button">Publish</button>
    <button type="button" id="preview">Preview</button>
    <div class="clear"></div>
  </div>

  <div id="dialog" style="display: none" title="Add Content">
    <table>
      <tbody>
        <tr><td><input type="file" id="upload" style="display: none" />
		<button onclick="$('#upload').click()">Upload</button>
	  </td>
          <td>
            <img src="icons/image.png" height="16" width="16"/>
            Image:&nbsp;png,&nbsp;jpg,&nbsp;gif,&nbsp;tiff<br />
            <img src="icons/audio.png" height="16" width="16"/>
            Audio:&nbsp;mp3,&nbsp;wav,&nbsp;aiff<br />
            <img src="icons/video.png" height="16" width="16"/>
            Video:&nbsp;mp4,&nbsp;avi,&nbsp;mov
          </td>
        </tr>
        <tr><td><button type="button">Create Text</button></td>
          <td>
            <img src="icons/text.png" height="16" width="16"/>
            Write new, or copy and paste</td>
        </tr>
        <tr><td><button type="button">Create Quiz</button></td>
          <td>
            <img src="icons/quiz.png" height="16" width="16"/>
            Questions, answer, hints
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div id="edit-image" style="display: none" title="Edit Content">
	<input type="text" size="55" class="title" />
	<img id="content" />
	<div>Description</div>
	<textarea rows="5" cols="55" id="description"></textarea>
  </div>

  <div id="edit-text" style="display: none" title="Edit Content">
	<input type="text" size="60" class="title" />
	<textarea rows="5" cols="50">
	hello world
	</textarea>
  </div>
</body>

<script type="text/javascript" src="js/jquery-1.6.1.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.14.custom.min.js"></script>
<script type="text/javascript" src="js/jquery.cleditor.js"></script>
<script type="text/javascript" src="js/param.js"></script>
<script type="text/javascript" src="AIRAliases.js"></script>
<script type="text/javascript">
$(document).ready(function() {
  air.HTMLLoader.placeLoadStringContentInApplicationSandbox = true;
  var q = queryParameters(document.location.search);
  $('#proj').text(q.name.toString());
  var f = new air.File(
	[air.File.applicationStorageDirectory.nativePath, q.name]
	.join(air.File.separator)
  );
  var files = f.getDirectoryListing();
  var types = {'png': 'image', 'gif':'image', 'txt':'text', 'html':'text', 'jpg': 'image'};
  var icons = {'image': "icons/image.png", 'text': "icons/text.png"};

  for(var f in files) {
	var tr = $('<tr />');
	var temp, base, ext;
	temp = files[f].name.match(/(.*)\.(\w+?)$/);
	base = temp[1];
	ext  = temp[2];
	if(!icons[types[ext]]) {
		continue;
	}
	tr.append($('<td class="icon"><img src="' + icons[types[ext]] + '"/></td>'));
	tr.append($('<td><a rel="' + types[ext] + '" href="' + files[f].nativePath + '">'
		+ base + '</a></td>'));
	tr.append($('<td>Unpublished</td>'));
	tr.append($('<td class="icon"><img src="icons/remove.png" alt="Remove Item" /></td>'));
	$('tbody.proj').append(tr);
  }
  $('a[rel]').click(function(e) {
	/*
	request = new air.URLRequest(
		'edit-' + e.target.rel + '.html?name=foo');
	loader = new air.URLLoader();
	loader.addEventListener(air.Event.COMPLETE, function(e) {
	*/
		//document.getElementById('edit').innerHTML = e.target.data;
	$('#edit-' + e.target.rel + ' input.title').val($(e.target).text());
	if(e.target.rel == 'image') {
		$('#edit-' + e.target.rel + ' img')
			.attr('src', 'file://' + $(e.target).attr('href'));
	}
	$('#edit-' + e.target.rel).dialog({
		autoOpen: true,
		modal: true,
		width: 540,
		position: 'top',
		buttons: {
		  "Replace": function() { 
		    $(this).dialog("close"); 
		  },
		  "Save": function() { 
		    var title = $('#edit-' + e.target.rel + ' input.title').val();
		    if($(e.target).text() != title) {
			var oldpath = $(e.target).attr('href');
			var newpath = oldpath.replace($(e.target).text, title);
			var f = new air.File(oldpath);
			f.moveTo(newpath);
		    }
		    $(this).dialog("close"); 
		  } 
		}
	});
	if(e.target.rel == 'text') {
		var f = new air.File($(e.target).attr('href'));
		var fs = new air.FileStream();
		fs.open(f, air.FileMode.READ);
		$('#edit-text textarea').val(
			fs.readMultiByte(fs.bytesAvailable, "utf-8"));
		$('#edit-text textarea').cleditor({
		controls: "bold italic underline bullets numbering alignleft " +
		          " center alignright justify undo redo cut copy paste"
		});
	}

	return false;
  });
  $('#preview').click(function() {
      window.location = 'preview.html';
  });
  $('.action a.alt').click(function() {
    $('#dialog').dialog({
      autoOpen: true,
      modal: true,
      width: 450,
      position: 'top',
      buttons: {
        "Cancel": function() { 
          $(this).dialog("close"); 
        } 
      }
    });
    return false;
  });

  $('#upload').click(function() {
    file = new window.runtime.flash.filesystem.File();
    file.addEventListener(air.Event.SELECT, function(f) {
	var end = file.url.slice(1 + file.url.lastIndexOf(air.File.separator));
	var dst = new air.File(
		[air.File.applicationStorageDirectory.nativePath,
                 q.name, end].join(air.File.separator));
	file.copyTo(dst, true);
    });
    fltr_img = new air.FileFilter("image", "*.png;*.gif;*.jpg;*.jpeg");
    fltr_doc = new air.FileFilter("text", "*.txt;*.html;*.htm");
    file.browseForOpen("Please select a file...", [fltr_img, fltr_doc]);
  });


/*
      $('textarea').wysiwyg(
      {controls: {
      subscript : { visible : false },
      strikeThrough : { visible : false },
      superscript : { visible : false },
      subscript : { visible : false },
      createLink : { visible : false },
      insertImage : { visible : false },
      insertTable : { visible : false },
      insertHorizontalRule : { visible : false },
      removeFormat : { visible : false },
      html : { visible : false },
      code : { visible : false },
      superscript : { visible : false }
      }});
*/
});
</script>
</html>
